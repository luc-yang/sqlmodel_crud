# æ–½å·¥åˆ†é¡µå·¥ç¨‹é‡ç»Ÿè®¡è½¯ä»¶æ•°æ®åº“ç»“æ„è¡¨

## ä¸€ã€å•ä½å·¥ç¨‹è¡¨ï¼ˆunit_projectï¼‰

**åŠŸèƒ½**ï¼šå­˜å‚¨é¡¹ç›®æ•´ä½“ä¿¡æ¯ï¼Œä½œä¸ºæœ€é«˜å±‚çº§çš„æ•°æ®å®¹å™¨ï¼Œå…³è”å¤šä¸ªåˆ†éƒ¨å·¥ç¨‹ã€‚

| å­—æ®µåï¼ˆè‹±æ–‡ï¼‰ | å­—æ®µåï¼ˆä¸­æ–‡ï¼‰ | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜                                         |
| :------------- | :------------- | :------- | :------- | :---------------- | :------------------------------------------- |
| id             | ä¸»é”® ID        | INTEGER  | æ˜¯       | è‡ªåŠ¨é€’å¢          | å”¯ä¸€æ ‡è¯†ï¼ŒSQLite è‡ªå¢ä¸»é”®                    |
| code           | å·¥ç¨‹ç¼–ç        | TEXT     | æ˜¯       | -                 | å•ä½å·¥ç¨‹å”¯ä¸€ç¼–ç ï¼Œä¸å¯é‡å¤ï¼Œå»ºè®®æ·»åŠ å”¯ä¸€ç´¢å¼• |
| name           | å·¥ç¨‹åç§°       | TEXT     | æ˜¯       | -                 | å•ä½å·¥ç¨‹å®Œæ•´åç§°                             |
| description    | å·¥ç¨‹æè¿°       | TEXT     | å¦       | NULL              | é¡¹ç›®æ¦‚å†µã€å»ºè®¾èŒƒå›´ç­‰è¯´æ˜                     |
| tags           | æ ‡ç­¾           | TEXT     | å¦       | NULL              | ç”¨äºåˆ†ç±»ç­›é€‰ï¼Œå¤šæ ‡ç­¾ç”¨é€—å·åˆ†éš”               |
| is_deleted     | è½¯åˆ é™¤æ ‡è®°     | INTEGER  | æ˜¯       | 0                 | 0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤ï¼Œå®ç°æ•°æ®é€»è¾‘åˆ é™¤         |
| created_at     | åˆ›å»ºæ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | è®°å½•æ•°æ®åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼              |
| updated_at     | æ›´æ–°æ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | è®°å½•æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ŒISO 8601 æ ¼å¼          |

**SQLite å»ºè¡¨è¯­å¥**ï¼š

```sql
CREATE TABLE unit_project (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code TEXT NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    tags TEXT,
    is_deleted INTEGER NOT NULL DEFAULT 0 CHECK (is_deleted IN (0, 1)),
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

-- ç´¢å¼•
CREATE UNIQUE INDEX idx_unit_project_code ON unit_project(code) WHERE is_deleted = 0;
```

---

## äºŒã€ä½ç½®ä¿¡æ¯è¡¨ï¼ˆlocationï¼‰

**åŠŸèƒ½**ï¼šå®ç°ä¸‰çº§åŒºåŸŸç®¡ç†ï¼ˆ1=æ¥¼æ ‹ â†’2=å±‚æ•° â†’3=æˆ¿é—´ï¼‰ï¼Œé€šè¿‡`parent_id`å»ºç«‹è‡ªå¼•ç”¨å±‚çº§å…³ç³»ã€‚

| å­—æ®µåï¼ˆè‹±æ–‡ï¼‰  | å­—æ®µåï¼ˆä¸­æ–‡ï¼‰ | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜                                             |
| :-------------- | :------------- | :------- | :------- | :---------------- | :----------------------------------------------- |
| id              | ä¸»é”® ID        | INTEGER  | æ˜¯       | è‡ªåŠ¨é€’å¢          | å”¯ä¸€æ ‡è¯†ï¼ŒSQLite è‡ªå¢ä¸»é”®                        |
| code            | ä½ç½®ç¼–ç        | TEXT     | æ˜¯       | -                 | ä¸‰çº§åŒºåŸŸç»Ÿä¸€ç¼–ç ï¼Œä¾‹å¦‚ï¼šæ¥¼æ ‹-å±‚æ•°-æˆ¿é—´ï¼Œå”¯ä¸€ç´¢å¼• |
| name            | ä½ç½®åç§°       | TEXT     | æ˜¯       | -                 | ä½ç½®ä¸­æ–‡å…¨ç§°ï¼Œä¾¿äºäººå·¥è¯†åˆ«                       |
| hierarchy_level | åŒºåŸŸå±‚çº§       | INTEGER  | æ˜¯       | -                 | 1=æ¥¼æ ‹ï¼Œ2=å±‚æ•°ï¼Œ3=æˆ¿é—´ï¼Œå›ºå®šæšä¸¾å€¼               |
| parent_id       | çˆ¶çº§ ID        | INTEGER  | å¦       | NULL              | å…³è”æœ¬è¡¨`id`ï¼Œå®ç°å±‚çº§å…³è”ï¼ˆä¸€çº§ä½ç½®æ— çˆ¶çº§ï¼‰     |
| description     | ä½ç½®æè¿°       | TEXT     | å¦       | NULL              | ä½ç½®ç‰¹æ€§è¯´æ˜ï¼ˆå¦‚é¢ç§¯ã€ç”¨é€”ï¼‰                     |
| tags            | æ ‡ç­¾           | TEXT     | å¦       | NULL              | ä½ç½®å±æ€§æ ‡ç­¾ï¼Œå¤šæ ‡ç­¾ç”¨é€—å·åˆ†éš”                   |
| is_deleted      | è½¯åˆ é™¤æ ‡è®°     | INTEGER  | æ˜¯       | 0                 | 0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤                               |
| created_at      | åˆ›å»ºæ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼                      |
| updated_at      | æ›´æ–°æ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ŒISO 8601 æ ¼å¼                  |

**SQLite å»ºè¡¨è¯­å¥**ï¼š

```sql
CREATE TABLE location (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code TEXT NOT NULL,
    name TEXT NOT NULL,
    hierarchy_level INTEGER NOT NULL CHECK (hierarchy_level IN (1, 2, 3)),
    parent_id INTEGER REFERENCES location(id) ON DELETE RESTRICT,
    description TEXT,
    tags TEXT,
    is_deleted INTEGER NOT NULL DEFAULT 0 CHECK (is_deleted IN (0, 1)),
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

-- ç´¢å¼•
CREATE UNIQUE INDEX idx_location_code ON location(code) WHERE is_deleted = 0;
CREATE INDEX idx_location_hierarchy_level ON location(hierarchy_level) WHERE is_deleted = 0;
CREATE INDEX idx_location_parent_id ON location(parent_id) WHERE is_deleted = 0;
```

---

## ä¸‰ã€åˆ†éƒ¨å·¥ç¨‹è¡¨ï¼ˆdivisional_workï¼‰

**åŠŸèƒ½**ï¼šå­˜å‚¨å•ä½å·¥ç¨‹ä¸‹çš„åˆ†éƒ¨å·¥ç¨‹ä¿¡æ¯ï¼ˆå¦‚åœŸå»ºã€æ°´ç”µã€è£…ä¿®ï¼‰ï¼Œå…³è”å¤šä¸ªå®šé¢æ•°æ®ã€‚

| å­—æ®µåï¼ˆè‹±æ–‡ï¼‰ | å­—æ®µåï¼ˆä¸­æ–‡ï¼‰ | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜                            |
| :------------- | :------------- | :------- | :------- | :---------------- | :------------------------------ |
| id             | ä¸»é”® ID        | INTEGER  | æ˜¯       | è‡ªåŠ¨é€’å¢          | å”¯ä¸€æ ‡è¯†ï¼ŒSQLite è‡ªå¢ä¸»é”®       |
| code           | åˆ†éƒ¨ç¼–ç        | TEXT     | æ˜¯       | -                 | åˆ†éƒ¨å·¥ç¨‹ç¼–ç ï¼Œå»ºè®®æ·»åŠ å”¯ä¸€ç´¢å¼•  |
| name           | åˆ†éƒ¨åç§°       | TEXT     | æ˜¯       | -                 | åˆ†éƒ¨å·¥ç¨‹åç§°                    |
| description    | åˆ†éƒ¨æè¿°       | TEXT     | å¦       | NULL              | åˆ†éƒ¨å·¥ç¨‹èŒƒå›´ã€æŠ€æœ¯è¦æ±‚è¯´æ˜      |
| tags           | æ ‡ç­¾           | TEXT     | å¦       | NULL              | åˆ†éƒ¨å±æ€§æ ‡ç­¾                    |
| is_deleted     | è½¯åˆ é™¤æ ‡è®°     | INTEGER  | æ˜¯       | 0                 | 0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤              |
| created_at     | åˆ›å»ºæ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼     |
| updated_at     | æ›´æ–°æ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ŒISO 8601 æ ¼å¼ |

**SQLite å»ºè¡¨è¯­å¥**ï¼š

```sql
CREATE TABLE divisional_work (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code TEXT NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    tags TEXT,
    is_deleted INTEGER NOT NULL DEFAULT 0 CHECK (is_deleted IN (0, 1)),
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

-- ç´¢å¼•
CREATE UNIQUE INDEX idx_divisional_work_code ON divisional_work(code) WHERE is_deleted = 0;
```

---

## å››ã€å®šé¢æ•°æ®è¡¨ï¼ˆquotaï¼‰

**åŠŸèƒ½**ï¼šå­˜å‚¨å®šé¢æ¨¡æ¿æ•°æ®

| å­—æ®µåï¼ˆè‹±æ–‡ï¼‰   | å­—æ®µåï¼ˆä¸­æ–‡ï¼‰ | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜                              |
| :--------------- | :------------- | :------- | :------- | :---------------- | :-------------------------------- |
| id               | ä¸»é”® ID        | INTEGER  | æ˜¯       | è‡ªåŠ¨é€’å¢          | å”¯ä¸€æ ‡è¯†ï¼ŒSQLite è‡ªå¢ä¸»é”®         |
| volume_name      | å†Œå           | TEXT     | æ˜¯       | -                 | å®šé¢æ‰€åœ¨å†Œçš„åç§°                  |
| chapter_name     | ç« èŠ‚å         | TEXT     | æ˜¯       | -                 | å®šé¢æ‰€åœ¨ç« çš„åç§°                  |
| code             | å®šé¢ç¼–ç        | TEXT     | æ˜¯       | -                 | å®šé¢æ ‡å‡†ç¼–ç ï¼Œå»ºè®®æ·»åŠ å”¯ä¸€ç´¢å¼•    |
| name             | å®šé¢åç§°       | TEXT     | æ˜¯       | -                 | å®šé¢å¯¹åº”çš„æ–½å·¥ä»»åŠ¡åç§°            |
| measurement_unit | è®¡é‡å•ä½       | TEXT     | æ˜¯       | -                 | å®šé¢è®¡ç®—å•ä½                      |
| workday          | å·¥æ—¥           | REAL     | å¦       | NULL              | å®Œæˆè¯¥ä»»åŠ¡æ‰€éœ€å·¥æ—¥                |
| work_content     | å·¥ä½œå†…å®¹       | TEXT     | æ˜¯       | -                 | è¯¦ç»†æ–½å·¥æ­¥éª¤ä¸èŒƒå›´                |
| resources        | èµ„æºæ˜ç»†       | TEXT     | å¦       | NULL              | æ‰€éœ€ææ–™/äººå·¥/æœºæ¢°ï¼ŒJSON æ ¼å¼å­˜å‚¨ |
| description      | å¤‡æ³¨           | TEXT     | å¦       | NULL              | å®šé¢è°ƒæ•´è¯´æ˜ã€ç‰¹æ®Šè¦æ±‚            |
| tags             | æ ‡ç­¾           | TEXT     | å¦       | NULL              | å®šé¢å±æ€§æ ‡ç­¾                      |
| is_deleted       | è½¯åˆ é™¤æ ‡è®°     | INTEGER  | æ˜¯       | 0                 | 0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤                |
| created_at       | åˆ›å»ºæ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼       |
| updated_at       | æ›´æ–°æ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ŒISO 8601 æ ¼å¼   |

**SQLite å»ºè¡¨è¯­å¥**ï¼š

```sql
CREATE TABLE quota (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    volume_name TEXT NOT NULL,
    chapter_name TEXT NOT NULL,
    code TEXT NOT NULL,
    name TEXT NOT NULL,
    measurement_unit TEXT NOT NULL,
    workday REAL CHECK (workday IS NULL OR workday > 0),
    work_content TEXT NOT NULL,
    resources TEXT CHECK (resources IS NULL OR json_valid(resources)),
    description TEXT,
    tags TEXT,
    is_deleted INTEGER NOT NULL DEFAULT 0 CHECK (is_deleted IN (0, 1)),
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

-- ç´¢å¼•
CREATE UNIQUE INDEX idx_quota_code ON quota(code) WHERE is_deleted = 0;
CREATE INDEX idx_quota_volume_chapter ON quota(volume_name, chapter_name) WHERE is_deleted = 0;
```

---

## äº”ã€æ–½å·¥å·¥ç¨‹é‡è¡¨ï¼ˆconstruction_quantityï¼‰

**åŠŸèƒ½**ï¼šå­˜å‚¨åˆ†é¡µå·¥ç¨‹é‡å…·ä½“æ•°é‡ï¼Œå…³è”åˆ†éƒ¨å·¥ç¨‹ä¸å…·ä½“ä½ç½®ï¼Œæ˜¯åˆ†é¡µå·¥ç¨‹é‡ç»Ÿè®¡çš„æ ¸å¿ƒè¡¨ã€‚

| å­—æ®µåï¼ˆè‹±æ–‡ï¼‰     | å­—æ®µåï¼ˆä¸­æ–‡ï¼‰ | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜                                 |
| :----------------- | :------------- | :------- | :------- | :---------------- | :----------------------------------- |
| id                 | ä¸»é”® ID        | INTEGER  | æ˜¯       | è‡ªåŠ¨é€’å¢          | å”¯ä¸€æ ‡è¯†ï¼ŒSQLite è‡ªå¢ä¸»é”®            |
| unit_project_id    | å•ä½å·¥ç¨‹ ID    | INTEGER  | æ˜¯       | -                 | å¤–é”®ï¼Œå…³è”`unit_project`è¡¨`id`       |
| divisional_work_id | åˆ†éƒ¨å·¥ç¨‹ ID    | INTEGER  | æ˜¯       | -                 | å¤–é”®ï¼Œå…³è”`divisional_work`è¡¨`id`    |
| location_id        | ä½ç½® ID        | INTEGER  | æ˜¯       | -                 | å¤–é”®ï¼Œå…³è”`location`è¡¨`id`           |
| quota_id           | å®šé¢ ID        | INTEGER  | æ˜¯       | -                 | å¤–é”®ï¼Œå…³è”`quota`è¡¨`id`              |
| quantity           | å·¥ç¨‹é‡æ•°é‡     | REAL     | æ˜¯       | -                 | è¯¥æ–½å·¥ä»»åŠ¡çš„å·¥ç¨‹é‡ï¼ˆå¦‚ 10 å¥—ã€20ã¡ï¼‰ |
| resources          | å®é™…èµ„æºæ˜ç»†   | TEXT     | å¦       | NULL              | åŸºäºå®šé¢è°ƒæ•´åçš„èµ„æºï¼ŒJSON æ ¼å¼      |
| description        | å·¥ç¨‹é‡è¯´æ˜     | TEXT     | å¦       | NULL              | è¯¥æ–½å·¥ä»»åŠ¡çš„ç‰¹æ®Šè¯´æ˜ï¼ˆå¦‚è°ƒæ•´åŸå› ï¼‰   |
| tags               | æ ‡ç­¾           | TEXT     | å¦       | NULL              | å¤šæ ‡ç­¾é€—å·åˆ†éš”                       |
| is_deleted         | è½¯åˆ é™¤æ ‡è®°     | INTEGER  | æ˜¯       | 0                 | 0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤                   |
| created_at         | åˆ›å»ºæ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼          |
| updated_at         | æ›´æ–°æ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ŒISO 8601 æ ¼å¼      |

**SQLite å»ºè¡¨è¯­å¥**ï¼š

```sql
CREATE TABLE construction_quantity (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    unit_project_id INTEGER NOT NULL REFERENCES unit_project(id) ON DELETE RESTRICT,
    divisional_work_id INTEGER NOT NULL REFERENCES divisional_work(id) ON DELETE RESTRICT,
    location_id INTEGER NOT NULL REFERENCES location(id) ON DELETE RESTRICT,
    quota_id INTEGER NOT NULL REFERENCES quota(id) ON DELETE RESTRICT,
    quantity REAL NOT NULL CHECK (quantity > 0),
    resources TEXT CHECK (resources IS NULL OR json_valid(resources)),
    description TEXT,
    tags TEXT,
    is_deleted INTEGER NOT NULL DEFAULT 0 CHECK (is_deleted IN (0, 1)),
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

-- ç´¢å¼•
CREATE INDEX idx_cq_unit_project_id ON construction_quantity(unit_project_id) WHERE is_deleted = 0;
CREATE INDEX idx_cq_divisional_work_id ON construction_quantity(divisional_work_id) WHERE is_deleted = 0;
CREATE INDEX idx_cq_location_id ON construction_quantity(location_id) WHERE is_deleted = 0;
CREATE INDEX idx_cq_quota_id ON construction_quantity(quota_id) WHERE is_deleted = 0;
CREATE INDEX idx_cq_unit_location ON construction_quantity(unit_project_id, location_id) WHERE is_deleted = 0;
```

---

## å…­ã€ç‰©èµ„è¡¨ï¼ˆresourceï¼‰

**åŠŸèƒ½**ï¼šå­˜å‚¨ç‰©èµ„çš„æ¨¡æ¿æ•°æ®ï¼Œä¾¿äºç”¨æˆ·å¿«é€Ÿå¡«å…¥èµ„æºæ•°æ®ã€‚åº”æ³¨æ„çš„æ˜¯ï¼Œç‰©èµ„è¡¨ä»…å­˜å‚¨æ¨¡æ¿æ•°æ®ï¼Œç”¨äºå®šé¢åŠå·¥ç¨‹é‡æ¨¡å—çš„èµ„æºå¿«é€Ÿå½•å…¥ï¼›æœªå•ç‹¬è®¾è®¡`quota_resource`å…³è”è¡¨ï¼Œæ ¸å¿ƒåŸå› æ˜¯æ–½å·¥ç‰©èµ„è§„æ ¼ç»´åº¦å¤šï¼ˆå¦‚é“åˆé‡‘ç™¾å¶é£å£çš„é•¿å®½å‹å·ï¼‰ï¼Œæå‰å…¨é‡å½•å…¥æ˜“äº§ç”Ÿå¤§é‡å†—ä½™ç›¸ä¼¼æ•°æ®ï¼Œä¸”æ— æ³•è¦†ç›–ç”¨æˆ·éæ ‡å½•å…¥åœºæ™¯ã€‚å› æ­¤å®šé¢è¡¨ã€å·¥ç¨‹é‡è¡¨ä¸­çš„ç‰©èµ„ä¿¡æ¯å‡ä»¥ JSON æ ¼å¼å­˜å‚¨ï¼Œç‰©èµ„è¡¨ä»…ä½œä¸ºå‚è€ƒæ¨¡æ¿ä½¿ç”¨ã€‚

| å­—æ®µåï¼ˆè‹±æ–‡ï¼‰   | å­—æ®µåï¼ˆä¸­æ–‡ï¼‰ | æ•°æ®ç±»å‹ | æ˜¯å¦å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜                            |
| :--------------- | :------------- | :------- | :------- | :---------------- | :------------------------------ |
| id               | ä¸»é”® ID        | INTEGER  | æ˜¯       | è‡ªåŠ¨é€’å¢          | å”¯ä¸€æ ‡è¯†ï¼ŒSQLite è‡ªå¢ä¸»é”®       |
| code             | ç‰©èµ„ç¼–ç        | TEXT     | æ˜¯       | -                 | ç‰©èµ„å”¯ä¸€ç¼–ç ï¼Œå»ºè®®æ·»åŠ å”¯ä¸€ç´¢å¼•  |
| type             | ç‰©èµ„ç±»åˆ«       | TEXT     | æ˜¯       | -                 | ç‰©èµ„åˆ†ç±»ï¼ˆä¸»æ/è¾…æ/æœºæ¢°/äººå·¥ï¼‰ |
| name             | ç‰©èµ„åç§°       | TEXT     | æ˜¯       | -                 | ç‰©èµ„åç§°                        |
| spec             | ç‰©èµ„è§„æ ¼       | TEXT     | å¦       | NULL              | ç‰©èµ„å‹å·è§„æ ¼                    |
| measurement_unit | ç‰©èµ„å•ä½       | TEXT     | æ˜¯       | -                 | ç‰©èµ„è®¡é‡å•ä½                    |
| consumption      | å®šé¢æ¶ˆè€—é‡     | REAL     | å¦       | NULL              | ç‰©èµ„å®šé¢æ¶ˆè€—é‡                  |
| description      | ç‰©èµ„è¯´æ˜       | TEXT     | å¦       | NULL              | ç‰©èµ„ç‰¹æ€§è¯´æ˜ã€ä½¿ç”¨è¦æ±‚          |
| tags             | æ ‡ç­¾           | TEXT     | å¦       | NULL              | å¤šæ ‡ç­¾é€—å·åˆ†éš”                  |
| is_deleted       | è½¯åˆ é™¤æ ‡è®°     | INTEGER  | æ˜¯       | 0                 | 0=æœªåˆ é™¤ï¼Œ1=å·²åˆ é™¤              |
| created_at       | åˆ›å»ºæ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®åˆ›å»ºæ—¶é—´ï¼ŒISO 8601 æ ¼å¼     |
| updated_at       | æ›´æ–°æ—¶é—´       | TEXT     | æ˜¯       | CURRENT_TIMESTAMP | æ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ŒISO 8601 æ ¼å¼ |

**SQLite å»ºè¡¨è¯­å¥**ï¼š

```sql
CREATE TABLE resource (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code TEXT NOT NULL,
    type TEXT NOT NULL CHECK (type IN ('ä¸»æ', 'è¾…æ', 'æœºæ¢°', 'äººå·¥')),
    name TEXT NOT NULL,
    spec TEXT,
    measurement_unit TEXT NOT NULL,
    consumption REAL CHECK (consumption IS NULL OR consumption >= 0),
    description TEXT,
    tags TEXT,
    is_deleted INTEGER NOT NULL DEFAULT 0 CHECK (is_deleted IN (0, 1)),
    created_at TEXT NOT NULL DEFAULT (datetime('now')),
    updated_at TEXT NOT NULL DEFAULT (datetime('now'))
);

-- ç´¢å¼•
CREATE UNIQUE INDEX idx_resource_code ON resource(code) WHERE is_deleted = 0;
CREATE INDEX idx_resource_type ON resource(type) WHERE is_deleted = 0;
```

---

## ä¸ƒã€æ•°æ®åº“å®ä½“ ER å…³ç³»å›¾

### ER å›¾ï¼ˆMermaid æ ¼å¼ï¼‰

```mermaid
erDiagram
    unit_project ||--o{ construction_quantity : "å…³è”"
    unit_project {
        INTEGER id PK "ä¸»é”®ID"
        TEXT code "å·¥ç¨‹ç¼–ç (å”¯ä¸€éƒ¨åˆ†ç´¢å¼•)"
        TEXT name "å·¥ç¨‹åç§°"
        TEXT description "å·¥ç¨‹æè¿°"
        TEXT tags "æ ‡ç­¾"
        INTEGER is_deleted "è½¯åˆ é™¤æ ‡è®°"
        TEXT created_at "åˆ›å»ºæ—¶é—´"
        TEXT updated_at "æ›´æ–°æ—¶é—´"
    }

    location ||--o{ location : "çˆ¶å­å±‚çº§"
    location ||--o{ construction_quantity : "å…³è”"
    location {
        INTEGER id PK "ä¸»é”®ID"
        TEXT code "ä½ç½®ç¼–ç (å”¯ä¸€éƒ¨åˆ†ç´¢å¼•)"
        TEXT name "ä½ç½®åç§°"
        INTEGER hierarchy_level "åŒºåŸŸå±‚çº§(1/2/3)"
        INTEGER parent_id FK "çˆ¶çº§ID"
        TEXT description "ä½ç½®æè¿°"
        TEXT tags "æ ‡ç­¾"
        INTEGER is_deleted "è½¯åˆ é™¤æ ‡è®°"
        TEXT created_at "åˆ›å»ºæ—¶é—´"
        TEXT updated_at "æ›´æ–°æ—¶é—´"
    }

    divisional_work ||--o{ construction_quantity : "å…³è”"
    divisional_work {
        INTEGER id PK "ä¸»é”®ID"
        TEXT code "åˆ†éƒ¨ç¼–ç (å”¯ä¸€éƒ¨åˆ†ç´¢å¼•)"
        TEXT name "åˆ†éƒ¨åç§°"
        TEXT description "åˆ†éƒ¨æè¿°"
        TEXT tags "æ ‡ç­¾"
        INTEGER is_deleted "è½¯åˆ é™¤æ ‡è®°"
        TEXT created_at "åˆ›å»ºæ—¶é—´"
        TEXT updated_at "æ›´æ–°æ—¶é—´"
    }

    quota ||--o{ construction_quantity : "å…³è”"
    quota {
        INTEGER id PK "ä¸»é”®ID"
        TEXT volume_name "å†Œå"
        TEXT chapter_name "ç« èŠ‚å"
        TEXT code "å®šé¢ç¼–ç (å”¯ä¸€éƒ¨åˆ†ç´¢å¼•)"
        TEXT name "å®šé¢åç§°"
        TEXT measurement_unit "è®¡é‡å•ä½"
        REAL workday "å·¥æ—¥"
        TEXT work_content "å·¥ä½œå†…å®¹"
        TEXT resources "èµ„æºæ˜ç»†"
        TEXT description "å¤‡æ³¨"
        TEXT tags "æ ‡ç­¾"
        INTEGER is_deleted "è½¯åˆ é™¤æ ‡è®°"
        TEXT created_at "åˆ›å»ºæ—¶é—´"
        TEXT updated_at "æ›´æ–°æ—¶é—´"
    }

    construction_quantity }o--|| unit_project : "å½’å±äº"
    construction_quantity }o--|| divisional_work : "å¼•ç”¨"
    construction_quantity }o--|| location : "ä½äº"
    construction_quantity }o--|| quota : "å¼•ç”¨"
    construction_quantity {
        INTEGER id PK "ä¸»é”®ID"
        INTEGER unit_project_id FK "å•ä½å·¥ç¨‹ID"
        INTEGER divisional_work_id FK "åˆ†éƒ¨å·¥ç¨‹ID"
        INTEGER location_id FK "ä½ç½®ID"
        INTEGER quota_id FK "å®šé¢ID"
        REAL quantity "å·¥ç¨‹é‡æ•°é‡"
        TEXT resources "å®é™…èµ„æºæ˜ç»†"
        TEXT description "å·¥ç¨‹é‡è¯´æ˜"
        TEXT tags "æ ‡ç­¾"
        INTEGER is_deleted "è½¯åˆ é™¤æ ‡è®°"
        TEXT created_at "åˆ›å»ºæ—¶é—´"
        TEXT updated_at "æ›´æ–°æ—¶é—´"
    }

    resource {
        INTEGER id PK "ä¸»é”®ID"
        TEXT code "ç‰©èµ„ç¼–ç (å”¯ä¸€éƒ¨åˆ†ç´¢å¼•)"
        TEXT type "ç‰©èµ„ç±»åˆ«"
        TEXT name "ç‰©èµ„åç§°"
        TEXT spec "ç‰©èµ„è§„æ ¼"
        TEXT measurement_unit "ç‰©èµ„å•ä½"
        REAL consumption "å®šé¢æ¶ˆè€—é‡"
        TEXT description "ç‰©èµ„è¯´æ˜"
        TEXT tags "æ ‡ç­¾"
        INTEGER is_deleted "è½¯åˆ é™¤æ ‡è®°"
        TEXT created_at "åˆ›å»ºæ—¶é—´"
        TEXT updated_at "æ›´æ–°æ—¶é—´"
    }
```

### ER å›¾è¯´æ˜

**å®ä½“å…³ç³»è¯´æ˜**ï¼š

1. **å•ä½å·¥ç¨‹ï¼ˆunit_projectï¼‰** æ˜¯é¡¶å±‚å®ä½“ï¼Œé€šè¿‡ construction_quantity è¡¨ä¸å…¶ä»–å®ä½“å…³è”
2. **åˆ†éƒ¨å·¥ç¨‹ï¼ˆdivisional_workï¼‰** æ˜¯ç‹¬ç«‹çš„æ¨¡æ¿æ•°æ®ï¼Œå¯è¢«å¤šä¸ªå·¥ç¨‹é‡è®°å½•å¼•ç”¨
3. **ä½ç½®ä¿¡æ¯ï¼ˆlocationï¼‰** å®ç°ä¸‰çº§åŒºåŸŸç®¡ç†ï¼ˆæ¥¼æ ‹ â†’ æ¥¼å±‚ â†’ æˆ¿é—´ï¼‰ï¼Œé€šè¿‡è‡ªå¼•ç”¨å»ºç«‹å±‚çº§å…³ç³»
4. **å®šé¢æ•°æ®ï¼ˆquotaï¼‰** æ˜¯ç‹¬ç«‹çš„æ¨¡æ¿æ•°æ®ï¼Œå¯è¢«å¤šä¸ªå·¥ç¨‹é‡è®°å½•å¼•ç”¨
5. **æ–½å·¥å·¥ç¨‹é‡ï¼ˆconstruction_quantityï¼‰** æ˜¯æ ¸å¿ƒä¸šåŠ¡å®ä½“ï¼Œå…³è”å•ä½å·¥ç¨‹ã€åˆ†éƒ¨å·¥ç¨‹ã€ä½ç½®å’Œå®šé¢
6. **ç‰©èµ„è¡¨ï¼ˆresourceï¼‰** å­˜å‚¨ç‰©èµ„æ¨¡æ¿æ•°æ®ï¼Œç‹¬ç«‹äºå…¶ä»–å®ä½“

**å…³ç³»ç±»å‹**ï¼š

- `||--o{` ä¸€å¯¹å¤šï¼ˆOne-to-Manyï¼‰
- `}o--||` å¤šå¯¹ä¸€ï¼ˆMany-to-Oneï¼‰
- `||--||` ä¸€å¯¹ä¸€ï¼ˆOne-to-Oneï¼‰

---

### ğŸ“‹ å‘½åè§„èŒƒæ€»ç»“

**éµå¾ªçš„å‘½åè§„èŒƒ**ï¼š

1. âœ… ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿åˆ†éš”ï¼ˆsnake_caseï¼‰
2. âœ… å¤–é”®å­—æ®µé‡‡ç”¨ `å…³è”è¡¨å_id` æ ¼å¼ï¼ˆå¦‚ `unit_project_id`ï¼‰
3. âœ… å¸ƒå°”å€¼ä½¿ç”¨ `is_` å‰ç¼€ï¼ˆå¦‚ `is_deleted`ï¼‰
4. âœ… æ—¶é—´æˆ³ä½¿ç”¨ `_at` åç¼€ï¼ˆå¦‚ `created_at`ï¼‰
5. âœ… åç§°ç®€æ´æ˜äº†ï¼Œé¿å…å†—ä½™

---

## æ•°æ®å®Œæ•´æ€§ä¿è¯

### 1. å®ä½“å®Œæ•´æ€§

- âœ… æ¯ä¸ªè¡¨éƒ½æœ‰ä¸»é”® `id`
- âœ… ä¸»é”®ä½¿ç”¨è‡ªå¢æ•´æ•°ï¼Œä¿è¯å”¯ä¸€æ€§

### 2. å‚ç…§å®Œæ•´æ€§

- âœ… å¤–é”®å…³è”è®¾è®¡åˆç†
- âœ… æ·»åŠ å¤–é”®çº¦æŸ

### 3. åŸŸå®Œæ•´æ€§

- âœ… ä½¿ç”¨é€‚å½“çš„æ•°æ®ç±»å‹
- âœ… è®¾ç½®äº† NOT NULL çº¦æŸ
- âœ… è®¾ç½®äº†é»˜è®¤å€¼
- âœ… æ·»åŠ  CHECK çº¦æŸ

### 4. è½¯åˆ é™¤è®¾è®¡

- âœ… æ‰€æœ‰è¡¨åŒ…å« `is_deleted` å­—æ®µ
- âœ… æŸ¥è¯¢æ—¶éœ€è¦è¿‡æ»¤ `WHERE is_deleted = 0`

---

## é™„å½•ï¼šä¸“ä¸šæœ¯è¯­å¯¹ç…§è¡¨

| ä¸­æ–‡æœ¯è¯­   | è‹±æ–‡å­—æ®µå            | è¯´æ˜                             |
| :--------- | :-------------------- | :------------------------------- |
| å•ä½å·¥ç¨‹   | unit_project          | å»ºç­‘å·¥ç¨‹çš„é¡¹ç›®æ•´ä½“               |
| åˆ†éƒ¨å·¥ç¨‹   | divisional_work       | å•ä½å·¥ç¨‹ä¸‹çš„åˆ†éƒ¨ï¼ˆå¦‚æš–é€šã€ç”µæ°”ï¼‰ |
| æ–½å·¥å·¥ç¨‹é‡ | construction_quantity | å…·ä½“æ–½å·¥ä»»åŠ¡çš„æ•°é‡ç»Ÿè®¡           |
| å®šé¢       | quota                 | æ–½å·¥å®šé¢æ ‡å‡†æ•°æ®                 |
| ç‰©èµ„       | resource              | æ–½å·¥æ‰€éœ€çš„ææ–™ã€è®¾å¤‡             |
| å·¥æ—¥       | workday               | å®Œæˆä»»åŠ¡æ‰€éœ€çš„å·¥ä½œæ—¥æ•°           |
| ä½ç½®       | location              | å»ºç­‘ç‰©çš„ä½ç½®å±‚çº§ä¿¡æ¯             |
| å†Œ         | volume_name           | å®šé¢æ‰‹å†Œçš„å†Œ                     |
| ç«          | chapter_name          | å®šé¢æ‰‹å†Œçš„ç«                      |
| è§„æ ¼       | spec                  | ææ–™æˆ–è®¾å¤‡çš„è§„æ ¼å‹å·             |
| æ¶ˆè€—é‡     | consumption           | ææ–™çš„å®šé¢æ¶ˆè€—æ•°é‡               |
